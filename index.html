<!DOCTYPE html>
<html>
<head>
    <title>RTVis WebGPU Tutorial</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #viewport {
            width: 100%;
            height: 100%;
            background: #c6339e;
        }
        #gui {
            position: fixed;
            top: 2em;
            left: 2em;
            bottom: 2em;
            width: 25%;
            background: #ffffffaa;
        }
    </style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>

<script src="tasks/task1.js"></script>
<script src="tasks/task2.js"></script>
<script src="tasks/task3.js"></script>

<script src="shaders/add.js"></script>

<script>
    // Declare global variables
    let GUI, CANVAS, ADAPTER, DEVICE;

    window.addEventListener("load", () => {
        // Initialize GUI
        GUI = new GUI({ name: document.title });
        GUI.root.id = "gui";
        const style = document.createElement("style");
        style.innerHTML = Gui.STYLE;
        document.head.appendChild(style);
        document.body.appendChild(GUI.root);

        // Initialize canvas
        CANVAS = document.createElement("canvas");
        CANVAS.id = "viewport";
        document.body.appendChild(CANVAS);
        window.addEventListener("resize", () => {
            CANVAS.width = window.innerWidth;
            CANVAS.height = window.innerHeight;
        });

        // Execute all tasks
        (async() => {
            const tasks = Object.entries(window)
                .filter(([key, task]) => key.startsWith("task"))
                .map(([key, task]) => [parseInt(key.substring(4)), key, task])
                .filter(([number, key, task]) => !isNaN(number))
                .sort(([number1, key1, task1], [number2, key2, task2]) => number1 - number2);
            for (const [number, key, task] of tasks) {
                try {
                    await task();
                } catch (e) {
                    const message = `Error in task ${number} ("${key}")`;
                    console.error(message, e);
                    alert(message + ": See console for details");
                    break;
                }
            }
        })();
    });
</script>

</body>
</html>